!function(){function a(a,c){var d=b(a);c===!0&&(d.self=!0),"function"==typeof z[d.command]?z[d.command](d):l.debug===!0&&A.console("Unsupported command: "+w.text(d.raw))}function b(a){var b={raw:a,tags:{},prefix:null,command:null,params:[],self:!1};a=a.replace(y.tags,function(a){return a.slice(1).replace(y.tagParser,function(a,c,d){return void 0===d?b.tags[c]=!0:b.tags[c]=d.replace(/\\:/g,";").replace(/\\s:/g," ").replace(/\\/g,"\\"),""}),""}),a=a.replace(y.prefix,function(a,c){return b.prefix=c,""});for(var c=!1;c===!1&&a.length>0;)c=!0,a=a.replace(y.params,function(a,d){return null===b.command?b.command=d:b.params.push(d),c=!1,""});return a.length>0&&b.params.push(a.slice(1)),b}function c(a,b,c){"undefined"==typeof G[a]?G[a]=new H(a,b,c):$('div.chatArea[title="'+a+'"]').is(":visible")===!1&&(f(),g(a))}function d(a,b){if(47===b.charCodeAt(0)){var c={channel:a,raw:b,command:null,params:null};c.command=b.split(" ").shift().toLowerCase().slice(1),-1!==b.search(" ")&&(c.params=b.substring(b.search(" ")+1)),"function"==typeof B[c.command]?B[c.command](c):T.send(c.raw.slice(1))}else T.privmsg(a,b)}function e(a,b){var c=a.match(s.modeSymbolRegex),d=b.match(s.modeSymbolRegex);if(null!==c&&null===d)return!0;if(null===c&&null!==d)return!1;if(null!==c&&null!==d){for(var e=0;e<s.modeSymbols.length;e++){if(-1!==c.indexOf(s.modeSymbols[e])&&-1===d.indexOf(s.modeSymbols[e]))return!0;if(-1===c.indexOf(s.modeSymbols[e])&&-1!==d.indexOf(s.modeSymbols[e]))return!1}if(a.toLowerCase()<b.toLowerCase())return!0}else if(a.toLowerCase()<b.toLowerCase())return!0;return!1}function f(){$("div.chatArea:visible").hide(),$("div.switchSelected").removeClass("switchSelected"),$("span.channelDropDownArrow").hide()}function g(a){$('div.chatArea[title="'+a+'"]').show(),G[a].scroll(),$('div.channelSwitch[title="'+a+'"]').removeClass("channelActivity").addClass("switchSelected"),$('div.channelSwitch[title="'+a+'"] > span.channelDropDownArrow').show()}function h(a){f(),g(a)}function i(){localStorage.setItem("options"+m,JSON.stringify(l))}function j(){return"Creep_"+Math.random().toString(36).substring(2,9)}var k=$(document.currentScript).attr("data-addr"),l={pings:!1,joins:!0,modes:!0,history:50,alternating:!0,snap:!0,timestamp:!0,console:!0,ircstyles:!0,debug:!1,images:"none",ignoreConsole:!0,ignoreFollow:!0,ignoreAbandon:!1,highlight:!0,saveNick:!0,saveChannels:!0,nick:null,channels:[],token:null},m=""===window.location.search?"Default":window.location.search,n=localStorage.getItem("options"+m);if("string"==typeof n)try{for(var o=JSON.parse(n),p=Object.keys(l),q=0;q<p.length;q++)"undefined"!=typeof l[p[q]]&&"undefined"!=typeof o[p[q]]&&(l[p[q]]=o[p[q]])}catch(r){console.log("Failed to load options: "+r),localStorage.setItem("options"+m,JSON.stringify(l))}null===l.nick&&(l.nick=j());var s={nick:l.nick,nickRegex:new RegExp("\\b"+l.nick+"\\b","g"),updateNick:function(a){s.nick=a,s.nickRegex=new RegExp("\\b"+a+"\\b","g"),l.saveNick===!0&&(l.nick=s.nick,i())},timeout:36e4,reconnectDelay:2e4,sendLimitMessages:10,sendLimitWindow:5e3,modeMap:{q:"~",a:"&",o:"@",h:"%",v:"+"},modeSymbols:["~","&","@","%","+"],modeSymbolRegex:new RegExp("[~&@%+]","g")};$("<link/>",{rel:"stylesheet",type:"text/css",href:"wirc.css"}).appendTo("head");var t=new function(){var a=[],b=localStorage.getItem("ignores"+m);if("string"==typeof b)try{a=JSON.parse(b)}catch(c){console.log("Failed to load ignores: "+c),localStorage.setItem("ignores"+m,JSON.stringify(a))}var d=function(){a.length>0?localStorage.setItem("ignores"+m,JSON.stringify(a)):localStorage.removeItem("ignores"+m),J.redrawIgnoreList()};this.getList=function(){return a},this.onList=function(b){return-1!==a.indexOf(b)},this.add=function(b){-1===a.indexOf(b)?(a.push(b),A.notification('"'+b+'" added to ignore list',"info"),d()):A.active('"'+b+'" is already on the ignore list',"info")},this.remove=function(b){-1!==a.indexOf(b)?(a.splice(a.indexOf(b),1),A.notification('"'+b+'" removed from ignore list',"info"),d()):A.active('"'+b+'" is not on the ignore list',"info")}},u=["imgur\\.com","i\\.imgur\\.com"];$(document.currentScript).parent().empty().append('<div id="chatBox"></div>'),$("#chatBox").append('<div id="chatHead"></div>');var v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},w={regex:{htmlCharacterMapRegex:new RegExp("["+Object.keys(v).join("")+"]","g"),imageRegex:/\b(https?:\/\/)?([\w\d.]+).\/([\w\d]+).(jpg|jpeg|gif|png)(\?[\w\d=]+)?\b/g,approvedImageRegex:new RegExp("\\b(https?:\\/\\/)?("+u.join("|")+"){1}\\/([\\w\\d]+).(jpg|jpeg|gif|png)(\\?[\\w\\d=]+)?\\b","g"),ircStyleRegex:/(\u0003(\d{0,2}(,\d{1,2})?))|(\u0002)|(\u0009)|(\u000F)|(\u0013)|(\u0015)|(\u001f)|(\u0016)/g,channelIDRegex:/(^|\s)(#\w+)/g,urlRegex:/\b(https?:\/\/)?([a-zA-Z0-9%_\-~]{1,256}\.)+[a-z]{2,6}(\/[a-zA-Z0-9@:;%_\-\+\.~#?&\/=]*)*\b/g,saneMessageRegex:/[\n\r]/g,saneInputRegex:/[\n\r: ]/g},html:function(a){return a.replace(w.regex.htmlCharacterMapRegex,function(a){return v[a]})},styles:function(a){function b(a){if(""===a)-1===e.indexOf("bold")?e.push("bold"):e.splice(e.indexOf("bold"),1);else if("	"===a)-1===e.indexOf("italic")?e.push("italic"):e.splice(e.indexOf("italic"),1);else if(""===a)e=[],c=-1,d=-1;else if(""===a)-1===e.indexOf("strikethrough")?e.push("strikethrough"):e.splice(e.indexOf("strikethrough"),1);else if(""===a||""===a)-1===e.indexOf("underline")?e.push("underline"):e.splice(e.indexOf("underline"),1);else if(""===a);else if(""===a)c=-1,d=-1;else{var b=a.slice(1).split(",");1===b.length?c=b[0]>=0&&b[0]<=15?parseInt(b[0],10):-1:b[0]>=0&&b[0]<=15&&b[1]>=0&&b[1]<=15?(c=parseInt(b[0],10),d=parseInt(b[1],10)):(c=-1,d=-1)}var g="";return f===!0&&(g+="</span>",f=!1),(-1!==c||-1!==d||e.length>0)&&(g+='<span class="',-1!==c&&(g+="fc"+c+" "),-1!==d&&(g+="bc"+d+" "),e.length>0&&(g+=e.join(" ")+" "),g=g.slice(0,-1)+'">',f=!0),g}var c=-1,d=-1,e=[],f=!1;if(l.ircstyles===!0){var g=a.replace(w.regex.ircStyleRegex,b);return f===!0&&(g+="</span>"),g}return a.replace(w.regex.ircStyleRegex,"")},text:function(a){return w.links(w.styles(w.html(a)))},images:function(a){var b="approved"===l.images?a.match(w.regex.approvedImageRegex):a.match(w.regex.imageRegex),c="";if(null!==b&&"object"==typeof b){b=b.filter(function(a,b,c){return c.indexOf(a)===b});for(var d in b)c+='<div class="thumbnailContainer"><a href="'+b[d]+'" title="'+b[d]+'" target="blank"><img class="thumbnail" src="'+b[d]+'" alt="'+b[d]+'"></a></div>'}return c},links:function(a){return w.channelID(w.url(a))},url:function(a){return a.replace(w.regex.urlRegex,function(a){return'<a href="'+(null===a.match(/^https?:\/\//g)?"http://"+a:a)+'" target="_blank" class="url" title="Click to open '+a+' in a new context">'+a+"</a>"})},channelID:function(a){return a.replace(w.regex.channelIDRegex,function(a,b,c){return b+'<a href="#" class="actionLink" title="Click to go to '+c+'" data-action="channel" data-message="'+c+'">'+c+"</a>"})},saneMessage:function(a){return a.replace(w.regex.saneMessageRegex,"")},saneInput:function(a){return a.replace(w.regex.saneInputRegex,"")},timestamp:function(a){var b="undefined"==typeof a?new Date:new Date(a);return'<div class="time'+(l.timestamp===!1?" hidden":"")+'">['+("0"+b.getHours()).slice(-2)+":"+("0"+b.getMinutes()).slice(-2)+":"+("0"+b.getSeconds()).slice(-2)+"]</div>"}},x={channel:function(a){T.join(a)},reconnect:function(){3===K.readyState?T.forceReconnect():A.active("Unable to reconnect when socket is not in closed state")},cancelConnect:function(){clearTimeout(P),null!==P&&3===K.readyState&&A.active("Connection cancelled, have a nice day"),P=null}};$("#chatBox").on("click","a.actionLink",function(a){a.preventDefault(),x[$(this).attr("data-action")]($(this).attr("data-message"))}),$("#chatBox").on("click","span.messageNick, div.userlist",function(a){a.preventDefault();var b=this;$("#dropdownMenu").is(":visible")===!1?($("div.chatArea:visible").append('<div id="dropdownMenu"></div>'),$("#dropdownMenu").css({left:Math.floor($(this).position().left),top:Math.floor($(this).position().top+$(this).outerHeight())}),$("#dropdownMenu").on("mouseleave",function(){$(this).remove()}),$("#dropdownMenu").append('<div id="openDialog">Open Dialog</div>'),$("#openDialog").on("click",function(){c($(b).attr("title"),!1)}),t.onList($(this).attr("title"))===!0?($("#dropdownMenu").append('<div id="unignore">Unignore</div>'),$("#unignore").on("click",function(){t.remove($(b).attr("title"))})):($("#dropdownMenu").append('<div id="ignore">Ignore</div>'),$("#ignore").on("click",function(){t.add($(b).attr("title"))}))):$("#dropdownMenu").remove()});var y={tags:/^@\S+\s/g,tagParser:/(?:([^;=\s]+)(?:=([^;\s]+))?)/g,prefix:/^(?::(\S+)\s)/g,params:/^(?:([^:\s]+)\s?)/g},z={PING:function(a){T.sendNow("PONG "+a.params[0]),l.pings===!0&&A.console(w.html("Received ping ("+a.raw+"), replied pong (PONG "+a.params[0]+")"))},CAP:function(a){"LS"===a.params[1]?("undefined"==typeof s.CAP&&(s.CAP={}),"*"===a.params[2]?(s.CAP.multilineLS===!1?s.CAP.LS=a.params[3]:s.CAP.LS+=" "+a.params[3],s.CAP.multilineLS=!0,A.active("Server capabilities: "+a.params[3])):(s.CAP.multilineLS===!0?s.CAP.LS+=" "+a.params[2]:s.CAP.LS=a.params[2],s.CAP.multilineLS=!1,0===R&&(R=1,T.login()),A.active("Server capabilities: "+a.params[2]))):"ACK"===a.params[1]?(l.debug&&A.console("CAP negotiation accepted: "+a.params[2]),s.CAP.ACK=a.params[2],1===R&&(R=2,T.login())):"NAK"===a.params[1]?(l.debug&&A.console("CAP negotiation rejected: "+a.params[2]),"undefined"==typeof s.CAP.ACK&&(s.CAP.ACK=""),1===R&&(R=2,T.login())):"LIST"===a.params[1]?A.active("Currently enabled capabilities: "+a.params[2]):A.console("Unrecognised CAP command: "+a.params.slice(1).join(" "))},AUTHENTICATE:function(a){2===R&&null!==l.token&&"+"===a.params[0]&&T.sendNow("AUTHENTICATE "+l.token),R=3,T.login()},JOIN:function(a){a.prefix.split("!")[0]===s.nick?(c(a.params[0],!0),l.saveChannels===!0&&-1===l.channels.indexOf(a.params[0])&&(l.channels.push(a.params[0]),i())):G[a.params[0]].user.join(a.prefix.split("!")[0])},PRIVMSG:function(a){var b=a.self===!0?s.nick:a.prefix.split("!")[0];1===a.params[1].charCodeAt(0)?0===a.params[1].indexOf("ACTION")?A.channel(a.params[0],'<span class="action">'+w.text("* "+b+a.params[1].slice(7,-1))+"</span>",a.self===!0?"self":void 0):"VERSION"===a.params[1]?T.notice(a.params[0]===s.nick?b:a.params[0],String.fromCharCode(1)+"VERSION pre alpha build"+String.fromCharCode(1)):"TIME"===a.params[1]?T.notice(a.params[0]===s.nick?b:a.params[0],String.fromCharCode(1)+"TIME "+(new Date).toLocaleString()+String.fromCharCode(1)):"SOURCE"===a.params[1]?T.notice(a.params[0]===s.nick?b:a.params[0],String.fromCharCode(1)+"SOURCE https://github.com/SilentArc/wirc"+String.fromCharCode(1)):"FINGER"===a.params[1]?T.notice(a.params[0]===s.nick?b:a.params[0],String.fromCharCode(1)+"FINGER kinky"+String.fromCharCode(1)):"PING"===a.params[1].split(" ")[0]?T.notice(a.params[0]===s.nick?b:a.params[0],a.params[1]):l.debug===!0&&A.console("CTCP "+a.params[1].slice(1,-1)+" request from "+b+" unsupported and ignored"):t.onList(b)===!0?A.ignore('Ignored message to "'+a.params[0]+'": <span class="spacer">&lt;</span><span class="messageNick" data-action="nick" title="'+b+'">'+w.text(b)+'</span><span class="spacer">&gt;</span> '+w.text(a.params[1])):a.params[0]===s.nick?A.channel(b,'<span class="spacer">&lt;</span><span class="messageNick" data-action="nick" title="'+b+'">'+w.text(b)+'</span><span class="spacer">&gt;</span> '+w.text(a.params[1])):A.channel(a.params[0],'<span class="spacer">&lt;</span><span class="messageNick" data-action="nick" title="'+b+'">'+w.text(b)+'</span><span class="spacer">&gt;</span> '+w.text(a.params[1]),b===s.nick?"self":"")},NOTICE:function(a){var b=a.self===!0?s.nick:a.prefix.split("!")[0];1===a.params[1].charCodeAt(0)?l.debug===!0&&A.console(w.text("*"+b+"* "+a.params[1]),"notice"):b===s.nick?A.active(w.text("*NOTICE to "+a.params[0]+"* "+a.params[1]),"notice"):A.active(w.text("*"+b+"* "+a.params[1]),"notice")},MODE:function(a){if(a.params[0]===s.nick)A.active(w.html("You have set mode: "+a.params[1]));else{var b=["O","o","v","k","l","b","e","I"];l.modes===!0&&G[a.params[0]].line('<span class="nick">'+w.html((null===a.prefix?s.nick:a.prefix.split("!")[0])+" has set mode: "+a.params.slice(1).join(" "))+"</span>");for(var c=a.params.slice(1);c.length>0;)if(43===c[0].charCodeAt(0))for(var d=c.shift().slice(1);d.length>0;){var e=d.charAt(0);if(d=d.slice(1),"string"==typeof s.modeMap[e]){var f=c.shift();G[a.params[0]].user.modeAdd(e,f)}else"string"==typeof b[e]&&c.shift()}else{if(45!==c[0].charCodeAt(0))break;for(var d=c.shift().slice(1);d.length>0;){var e=d.charAt(0);if(d=d.slice(1),"string"==typeof s.modeMap[e]){var f=c.shift();G[a.params[0]].user.modeSub(e,f)}else"string"==typeof b[e]&&c.shift()}}}},NICK:function(a){var b=a.prefix.split("!")[0];b===s.nick&&(s.updateNick(a.params[0]),A.console('<span class="nick">'+w.html(b+" is now known as "+a.params[0])+"</span>")),l.ignoreFollow===!0&&t.onList(b)===!0&&t.add(a.params[0]),l.ignoreAbandon===!0&&t.onList(b)===!0&&t.remove(b);for(var c in G)":Console"!==c&&G[c].user.nick(b,a.params[0])},PART:function(a){a.prefix.split("!")[0]===s.nick?(G[a.params[0]].close("You have left channel "+a.params[0]+("undefined"==typeof a.params[1]?"":": "+a.params[1])),l.saveChannels===!0&&-1!==l.channels.indexOf(a.params[0])&&(l.channels.splice(l.channels.indexOf(a.params[0]),1),i())):G[a.params[0]].user.part(a.prefix.split("!")[0],a.params[1])},QUIT:function(a){var b=a.prefix.split("!")[0],c=a.params[0];for(var d in G)":Console"!==d&&G[d].user.quit(b,c)},KICK:function(a){a.params[1]===s.nick?(G[a.params[0]].close("You have been kicked from channel "+a.params[0]+": "+a.params[2]),l.saveChannels===!0&&-1!==l.channels.indexOf(a.params[0])&&(l.channels.splice(l.channels.indexOf(a.params[0]),1),i())):G[a.params[0]].user.kick(a.params[1],a.params[2])},TOPIC:function(a){a.self===!1&&A.channel(a.params[0],'<span class="info">'+w.text(a.prefix.split("!")[0]+" has changed the topic for "+a.params[0]+' to "'+a.params[1]+'"')+"</span>")},ERROR:function(a){A.console(w.text(a.raw))},"001":function(a){A.console(w.text(a.params[1]))},"002":function(a){A.console(w.text(a.params[1]))},"003":function(a){A.console(w.text(a.params[1]))},"004":function(a){a.params.length>2?A.console(w.text("Server "+a.params[1]+" version "+a.params[2]+' supporting user modes "'+a.params[3]+'" and channel modes "'+a.params[4]+'"')):A.console(w.text(a.params[1]))},"005":function(a){A.console("This server supports: "+w.text(a.params.slice(1).join(" "))),"undefined"==typeof s.ISUPPORT&&(s.ISUPPORT={});for(var b=1;b<a.params.length;b++)-1===a.params[b].indexOf("=")?s.ISUPPORT[a.params[b]]=!0:s.ISUPPORT[a.params[b].split("=")[0]]=a.params[b].split("=")[1];s.modeSymbols=s.ISUPPORT.PREFIX.split(")")[1].split(""),s.modeSymbolRegex=new RegExp("["+s.ISUPPORT.PREFIX.split(")")[1]+"]","g");var c=s.ISUPPORT.PREFIX.split(")")[0].split("(")[1].split("");s.modeMap={};for(var b=0;b<c.length&&b<s.modeSymbols.length;b++)s.modeMap[c[b]]=s.modeSymbols[b]},251:function(a){A.console(w.text(a.params[1]))},252:function(a){A.console(w.text(a.params.slice(1).join(" ")))},253:function(a){A.console(w.text(a.params.slice(1).join(" ")))},254:function(a){A.console(w.text(a.params.slice(1).join(" ")))},255:function(a){A.console(w.text(a.params[1]))},265:function(a){A.console(w.text(a.params[1]))},266:function(a){A.console(w.text(a.params[1]))},315:function(a){A.active(w.text(a.params[1]+" :"+a.params[2]))},324:function(a){G[a.params[1]].modes(a.raw)},331:function(a){A.channel(a.params[1],'<span class="info">Topic for '+w.text(a.params[1]+" is: "+a.params[2])+"</span>")},332:function(a){A.channel(a.params[1],'<span class="info">Topic for '+w.text(a.params[1]+" is: "+a.params[2])+"</span>")},333:function(a){A.channel(a.params[1],'<span class="info">Topic set by '+w.text(a.params[2].split("!")[0]+" on "+new Date(1e3*a.params[3]).toString())+"</span>")},352:function(a){A.active(w.text(a.params.slice(1).join(" ")))},353:function(a){G[a.params[2]].user.handle353(a.params[3].split(" "))},366:function(a){G[a.params[1]].user.handle366()},372:function(a){A.console(w.text(a.params[1]))},375:function(a){A.console(w.html(a.params[1]))},376:function(a){if(A.console(w.html(a.params[1])),"object"==typeof l.channels)for(var b=0;b<l.channels.length;b++)T.join(l.channels[b])},403:function(a){A.active(w.html(a.params.join(" ")))},421:function(a){A.active(w.html(a.params[1]+" :"+a.params.slice(2).join(" ")))},432:function(a){if(A.active(w.html(a.params.slice(1).join(" ")),"error"),"*"===a.params[0])T.nick(j());else{s.updateNick(a.params[0]);for(var b in G)G[b].user.nick(a.params[1],s.nick)}},433:function(a){if(A.active(w.html(a.params.slice(1).join(" ")),"error"),"*"===a.params[0])T.nick(j());else{s.updateNick(a.params[0]);for(var b in G)G[b].user.nick(a.params[1],s.nick)}},461:function(a){A.active(w.html(a.params[1]+" "+a.params[2]))},482:function(a){A.active(w.html(a.params[1]+" "+a.params[2]))},900:function(a){A.active(w.html("SASL: "+a.params[3]))},901:function(a){A.active(w.html("SASL: "+a.params[2]),"warning")},902:function(a){A.active(w.html("SASL: "+a.params[1]),"error")},903:function(a){A.active(w.html(a.params[1]))},904:function(a){A.active(w.html(a.params[1]),"warning")},905:function(a){A.active(w.html(a.params[1]),"warning")},906:function(a){A.active(w.html(a.params[1]),"warning")},907:function(a){A.active(w.html(a.params[1]),"warning")},908:function(a){A.active(w.html(a.params[1]+" "+a.params[1]))},926:function(a){A.active(w.html(a.params[2]),"error")}},A={channel:function(a,b,d){void 0!==G[a]?G[a].line(b,d):(c(a,!1,!1),G[a].line(b,d))},console:function(a,b){G[":Console"].line(a,b)},active:function(a,b){var c=$("div.chatArea:visible").attr("title");void 0!==c?A.channel(c,a,b):A.console(a,b)},notification:function(a,b){var c=$("div.chatArea:visible").attr("title");void 0!==c&&":"!==c.charAt(0)&&A.channel(c,a,b),A.console(a,b)},ignore:function(a){l.ignoreConsole===!0&&A.console(a)}},B={me:function(a){T.action(a.channel,a.params)},nick:function(a){T.nick(a.params.split(" ")[0])},join:function(a){T.join(a.params)},notice:function(a){T.notice(a.params.split(" ")[0],a.params.split(" ").slice(1).join(" "))},say:function(a){T.privmsg(a.params.split(" ")[0],a.params.split(" ").slice(1).join(" "))},privmsg:function(a){T.privmsg(a.params.split(" ")[0],a.params.split(" ").slice(1).join(" "))},part:function(a){null===a.params&&":Console"!==a.channel?T.part(a.channel):T.part(a.params.split(" ")[0],a.params.split(" ").slice(1).join(" "))},quit:function(a){T.quit(a.params)},mode:function(a){T.send("MODE "+a.params)},ignore:function(a){t.add(a.params)},unignore:function(a){t.remove(a.params)},topic:function(a){T.topic(a.channel,a.params)}},C=function(){var a=!0;return function(){return a?(a=!1,"light"):(a=!0,l.alternating===!0?"dark":"light")}},D=function(a,b){function c(){if(""!==h.val()){var b=w.saneMessage(h.val());e.unshift(b),e.length>20&&e.pop(),f=null,g=h.val(),h.val(""),h.focus(),d(a,b)}}var e=[],f=null,g="";b.append('<div class="chatInput"><form><input class="input" title="type your message and hit enter to send" type="text"><button class="send" title="Sir, are you sure you want to say that? Sir? SIR?">Send</button></form></div>');var h=b.find(".input");this.focus=function(){h.focus()},h.focus(),h.on("keydown",function(a){"function"==typeof i[a.which]&&(a.preventDefault(),i[a.which]())}),b.find(".send").on("click",function(a){a.preventDefault(),c()});var i={13:function(){c()},9:function(){var a=[],c=h.val().split(" ").slice(-1)[0];if(c.length>0){var d=new RegExp("^"+c.toLowerCase(),"g");b.find("div.userlist").each(function(b){d.test($(this).text().toLowerCase())===!0&&a.push($(this).text())}),1===a.length?h.val(h.val().replace(new RegExp(c+"$"),a[0])):a.length>1&&A.active(w.html("Possible matches: "+a.join(", ")),"info")}},38:function(){e.length>0&&(null===f?(f=0,g=h.val(),h.val(e[f])):f+1>=e.length?(f=null,h.val(g)):(f++,h.val(e[f])))},40:function(){e.length>0&&(null===f?(f=e.length-1,g=h.val(),h.val(e[f])):0>f-1?(f=null,h.val(g)):(f--,h.val(e[f])))}}},E=function(a,b){b.append('<div class="chatSidebar userSidebar"></div>');var c=b.find("div.userSidebar"),d=!0;this.toggle=function(){c.is(":visible")===!1?c.show():c.hide()},this.update=function(){l.alternating===!0?($("div.userlist").removeClass("light dark"),$("div.userlist:even").addClass("light"),$("div.userlist:odd").addClass("dark")):$("div.userlist:not( light )").removeClass("dark").addClass("light")},this.handle353=function(b){d===!0&&(c.find("div.userlist").remove(),d=!1);for(var e in b)G[a].user.add(b[e].replace(s.modeSymbolRegex,""),b[e]);G[a].user.update()},this.handle366=function(){d=!0},this.join=function(b){l.joins===!0&&G[a].line('<span class="join">'+w.html(b+" has joined "+a)+"</span>"),G[a].user.add(b,b),G[a].user.update()},this.nick=function(b,d){if(c.find('div.userlist[title="'+b+'"]').length>0){G[a].line('<span class="nick">'+w.html(b+" is now known as "+d)+"</span>");var e=$('div.userlist[title="'+b+'"]').text().match(s.modeSymbolRegex);c.find('div.userlist[title="'+b+'"]').remove();var f=null===e?d:e.join("")+d;G[a].user.add(d,f),G[a].user.update()}},this.modeAdd=function(b,d){var e=c.find('div.userlist[title="'+d+'"]').text();-1===e.indexOf(s.modeMap[b])&&(c.find('div.userlist[title="'+d+'"]').remove(),G[a].user.add(d,s.modeMap[b]+(0===e.length?d:e)),G[a].user.update())},this.modeSub=function(b,d){var e=c.find('div.userlist[title="'+d+'"]').text();-1!==e.indexOf(s.modeMap[b])&&(c.find('div.userlist[title="'+d+'"]').remove(),G[a].user.add(d,e.replace(new RegExp("["+s.modeMap[b]+"]","g"),"")),G[a].user.update())},this.part=function(b,d){l.joins===!0&&G[a].line('<span class="part">'+w.html(b+" has left "+a+("undefined"==typeof d?"":": "+d))+"</span>"),c.find('div.userlist[title="'+b+'"]').remove(),G[a].user.update()},this.quit=function(b,d){c.find('div.userlist[title="'+b+'"]').length>0&&(l.joins===!0&&G[a].line('<span class="quit">'+w.html(b+" has quit: "+d)+"</span>"),c.find('div.userlist[title="'+b+'"]').remove(),G[a].user.update())},this.kick=function(b,d){G[a].line('<span class="kick">'+w.html(b+" has been kicked from "+a+": "+d)+"</span>"),c.find('div.userlist[title="'+b+'"]').remove(),G[a].user.update()},this.add=function(a,b){var d=!1;c.find("div.userlist").each(function(){return e(b,$(this).text())===!0?($('<div class="userlist" title="'+w.html(a)+'">'+w.html(b)+"</div>").insertBefore($(this)),d=!0,!1):void 0}),d===!1&&c.append('<div class="userlist" title="'+w.html(a)+'">'+w.html(b)+"</div>")}},F=function(a){this.nick=function(b,c){b===a?(G[a].line('<span class="nick">'+w.html(b+" is now known as "+c)+"</span>"),G[a].renameChannel(c)):":Console"===a&&c===s.nick&&G[a].line(w.text("You have changed your nickname to "+c))},this.quit=function(b,c){b===a&&G[a].line(w.html(b+" has quit: "+c))}},G={},H=function(a,b,c){var d=this,e=a,i=[],j=b===!0,k=!0;l.snap===!0&&f(),$("#chatBox").append('<div class="chatArea" title="'+e+'"></div>');var m=$('div.chatArea[title="'+e+'"]');if(l.snap===!1&&m.hide(),c===!0){$("#chatHead").append('<div class="channelSwitch" title=":Console">&nbsp;&gt;&nbsp;</div>');var n=$('div.channelSwitch[title=":Console"]');l.console===!1&&n.hide(),n.on("click",function(a){$("#dropdownMenu").remove(),m.is(":visible")===!1&&(h(e),p.focus())})}else{$("#chatHead").append('<div class="channelSwitch" title="'+e+'">&nbsp;'+e+'&nbsp;<span class="channelDropDownArrow">&#9660;</span></div>');var n=$('div.channelSwitch[title="'+e+'"]');n.on("click",function(a){m.is(":visible")===!0?$("#dropdownMenu").is(":visible")===!1?d.dropdownMenu($(this).position().left):$("#dropdownMenu").remove():($("#dropdownMenu").remove(),h(e),p.focus())})}n.removeClass("channelActivity").addClass("switchSelected"),j===!0?this.user=new E(e,m):this.user=new F(e),m.append('<div class="chatText"></div>');var o=m.find(".chatText");o.on("scroll",function(a){k=o.scrollTop()+o.height()===o.prop("scrollHeight")});var p=new D(e,m);this.scroll=function(){k===!0&&m.is(":visible")&&o.scrollTop(o.prop("scrollHeight"))},this.dropdownMenu=function(a){$("#dropdownMenu").remove(),m.append('<div id="dropdownMenu"></div>'),$("#dropdownMenu").css("left","number"==typeof a?Math.floor(a):0),$("#dropdownMenu").on("mouseleave",function(){$(this).remove()}),j===!0?($("#dropdownMenu").append('<div id="toggleUserlist">Show Userlist</div>'),$("#toggleUserlist").on("click",function(){d.user.toggle()}),$("#dropdownMenu").append('<div id="fetchTopic">Fetch Topic</div>'),$("#fetchTopic").on("click",function(){T.topic(e)}),$("#dropdownMenu").append('<div id="partChannel">Part Channel</div>'),$("#partChannel").on("click",function(){T.part(e)})):($("#dropdownMenu").append('<div id="partChannel">Close Dialog</div>'),$("#partChannel").on("click",function(){d.close()}))},this.renameChannel=function(a){var b=e;e=a,m.attr("title",e),m=$('div.chatArea[title="'+e+'"]'),n.attr("title",e),n.html("&nbsp;"+e+'&nbsp;<span class="channelDropDownArrow">&#9660;</span>'),n=$('div.channelSwitch[title="'+e+'"]'),m.is(":visible")===!1&&n.find("span.channelDropDownArrow").hide(),G[a]=G[b],delete G[b]},this.close=function(a){m.remove(),n.remove(),delete G[e];var b=Object.keys(G);g(b[b.length-1]),"string"==typeof a&&A.active(a,"info")},this.modes=function(a){var b=a[4].trim();d.line(a[0]+" has set channel mode "+b),b=b.split("");var c=!0;for(var e in b)"+"===b[e]?c=!0:"-"===b[e]?c=!1:c===!0&&-1===i.indexOf(b[e])?i.push(b[e]):-1!==i.indexOf(b[e])&&i.splice(i.indexOf(b[e]),1)};var q=new C;this.line=function(a,b,c){var d='<div class="ircText';"self"===b?d+=" self":"error"===b?d+=" error":"info"===b?d+=" info":"warning"===b?d+=" warning":l.highlight===!0&&-1!==a.search(s.nickRegex)&&(d+=" highlight"),d+='">'+w.timestamp("undefined"==typeof c?void 0:c)+" ",d+='<div class="messageContainer',"notice"===b&&(d+=" notice"),d+='">'+a+"</div>",j===!0&&"none"!==l.images&&(d+=w.images(a)),d+="</div>",G[e].append(d)},this.append=function(a){n.hasClass("switchSelected")===!1&&n.addClass("channelActivity"),o.find("div.ircText").length>=l.history&&o.find(">:first-child").remove(),$(a).appendTo(o).addClass(q()),G[e].scroll()}};G[":Console"]=new H(":Console",!1,!0),A.console("Welcome to the internets, your connection will establish shortly..."),$("#chatBox").append('<div class="chatArea helpBox" Title=":Help"></div>'),$("#chatHead").append('<div class="channelSwitch specialSwitch" title="Help">&nbsp;&#9072;&nbsp;</div>'),$('div.specialSwitch[title="Help"]').on("click",function(a){$("div.helpBox").is(":visible")||(f(),$("div.helpBox").show(),$(this).addClass("switchSelected"))});var I='<div class="help">';I+="<div>bug list</div>",I+="<hr />",I+="<div>scroll down after image loading?</div>",I+="<div>url detection regex not picking up trailing slashes</div>",I+="<div>all the broken things</div>",I+="<hr /><hr />",I+="1.0 proposed feature list",I+="<hr />",I+="<div>actual helptext</div>",I+="<div>options page layout</div>",I+="<div>all the numerics I've missed</div>",I+="<div>channel modes in dropdown menu</div>",I+="<div>time format options</div>",I+="<div>option to have userlists open by default</div>",I+="<div>option to show hostmasks in join/quit and userlist (dropdown?)</div>",I+="<div>options (specifically nick box) refreshing on opening</div>",I+="<div>sort out if flex-grow should be 1 or less to push images all the way to the right or just a little</div>",I+="<div>sort adding modes in userlist by priority</div>",I+="<div>default inline images to disabled</div>",I+="<hr /><hr />",I+="1.2 proposed feature list",I+="<hr />",I+="<div>outbound ctcp requests?</div>",I+="<div>input formatting options</div>",I+="<div>tab completion mid input</div>",I+="<div>coloured username options (random/hash/modes)</div>",I+="<div>highlight by additional/selective words/regex</div>",I+="<div>channel tab highlight option to trigger only on messages/different colours for joins/parts, messages and highlights</div>",I+="<div>stylesheet choices</div>",I+="<div>bake css into javascript</div>",I+="<div>revisit allowing channel windows to remain open on part/kick/disconnect</div>",I+="</div>",$("div.helpBox").html(I);var J={toggle:function(a,b,c){$("div.optionBox").append('<div class="option" id="option_'+a+'">'+b+"</div>"),$("#option_"+a).addClass(l[a]===!0?"optionOn":"optionOff"),$("#option_"+a).on("click",function(){l[$(this).prop("id").split("_")[1]]?($(this).removeClass("optionOn").addClass("optionOff"),l[$(this).prop("id").split("_")[1]]=!1):($(this).removeClass("optionOff").addClass("optionOn"),l[$(this).prop("id").split("_")[1]]=!0),i(),"function"==typeof c&&c()})},selector:function(a,b,c,d){$("div.optionBox").append('<div class="option" id="option_'+a+'">'+b+"</div>"),$("#option_"+a).text($("#option_"+a).text()+" "+l[a]),$("#option_"+a).on("click",function(){var a=$(this).text().split(" ");a=a[a.length-1].trim();var b=c.indexOf(a)+1;b=b>=c.length?c[0]:c[b],l[$(this).prop("id").split("_")[1]]=b,$(this).text($(this).text().replace(a,b)),i(),"function"==typeof d&&d()})},input:function(a,b,c,d){$("div.optionBox").append('<div class="option" id="option_'+a+'">'+b+': <input class="optionInput" data-id="'+a+'" value="'+(null===l[a]?"":l[a])+'"><button class="optionButton" data-id="'+a+'" title="Sir, Are you sure that\'s wise? Sir? SIR?">Set</button></div>'),$('button.optionButton[data-id="'+a+'"]').on("click",function(a){a.preventDefault();var b=$(this).attr("data-id");l[b]="message"===c?w.saneMessage($('input.optionInput[data-id="'+b+'"]').val()):w.saneInput($('input.optionInput[data-id="'+b+'"]').val()),i(),$("#option_"+b).append('<span class="optionResult">Saved!</span>'),setTimeout(function(){$("span.optionResult").remove()},3e3),"function"==typeof d&&d()})},listInput:function(a,b,c){$("div.optionBox").append('<div class="option" id="option_'+a+'">'+b+': <input class="optionInput" data-id="'+a+'" value="'+(null===l[a]?"":l[a])+'"><button class="optionButton" data-id="'+a+'" title="Sir, Are you sure that\'s wise? Sir? SIR?">Set</button></div>'),$('button.optionButton[data-id="'+a+'"]').on("click",function(a){a.preventDefault();var b=$(this).attr("data-id"),d=$('input.optionInput[data-id="'+b+'"]').val();if(null===d||0===d.length)l[b]=[];else{d=d.split(",");for(var e=[],f=0;f<d.length;f++)e.push(w.saneInput(d[f].trim()));l[b]=e}i(),$("#option_"+b).append('<span class="optionResult">Saved!</span>'),setTimeout(function(){$("span.optionResult").remove()},3e3),"function"==typeof c&&c()})},spacer:function(a){$("div.optionBox").append('<div class="optionHeader">'+(a?a:"&nbsp;")+"</div>")},redrawIgnoreList:function(){if($("#ignoreList").find("div").remove(),t.getList().length>0)for(var a=0;a<t.getList().length;a++)$("#ignoreList").append('<div><span class="messageNick" data-action="nick" title="'+t.getList()[a]+'">'+t.getList()[a]+"</span></div>");else $("#ignoreList").append("<div>No entries</div>")},updateInputs:function(){$("input.optionInput").each(function(){$(this).val(l[$(this).attr("data-id")])})}};$("#chatBox").append('<div class="chatArea optionBox" title=":Settings"></div>'),$("#chatHead").append('<div class="channelSwitch specialSwitch" title="Settings">&nbsp;&#9881;&nbsp;</div>'),$('div.specialSwitch[title="Settings"]').on("click",function(a){$("div.optionBox").is(":visible")||(f(),$("div.optionBox").show(),$(this).addClass("switchSelected"),J.redrawIgnoreList(),J.updateInputs())}),J.spacer("Self"),J.toggle("saveNick","Keep nickname for future sessions"),J.input("nick","Your nickname","input",function(){T.nick(l.nick)}),J.input("token","Login token or password","message"),J.spacer("Console"),J.toggle("pings","Show pings/pongs"),J.toggle("console","Show Console",function(){l.console===!0?$('div.channelSwitch[title=":Console"]').show():$('div.channelSwitch[title=":Console"]').hide()}),J.spacer("Channels"),J.toggle("saveChannels","Reopen channels from previous sessions"),J.listInput("channels","Auto join channels"),J.toggle("joins","Show joins/parts"),J.toggle("modes","Show mode changes"),
J.selector("history","Lines of history retained:",["40","60","80","100"],function(){l.history=parseInt(l.history,10),i(),$("div.chatText").each(function(){$(this).children().slice(0,-1*l.history).remove()})}),J.toggle("alternating","Toggle alternating backgrounds",function(){l.alternating===!1?($("div.userlist:not( light )").removeClass("dark").addClass("light"),$("div.ircText:not( light )").removeClass("dark").addClass("light")):($("div.userlist:even").addClass("dark"),$("div.ircText:even").addClass("dark"))}),J.toggle("snap","Snap on channel open"),J.toggle("timestamp","Show timestamps",function(){l.timestamp===!0?$("div.time").removeClass("hidden"):$("div.time").addClass("hidden")}),J.toggle("highlight","Highlight lines containing own nickname"),J.selector("images","Display inline images:",["all","approved","none"]),J.toggle("ircstyles","Allow irc style formatted text"),J.spacer("Other"),J.toggle("debug","Unnecessary extra information for debugging"),J.spacer("Users"),J.toggle("ignoreConsole","Send ignored user messages to the console"),J.toggle("ignoreFollow","Follow nick changes and ignore those as well"),J.toggle("ignoreAbandon","Remove ignores for ignored nicks changed away from"),J.spacer("Ignore List:"),$("div.optionBox").append('<div id="ignoreList"></div>'),J.redrawIgnoreList();for(var K,L=!1,M=!1,N={close:function(){K.close()},send:function(a){K.send(a)},connect:function(){K=new WebSocket(k),L=!1,K.onerror=function(a){A.console("A websocket error has occured, please wait while the websocket is turned off and on again","error")},K.onclose=function(a){for(var b in G)":Console"!==b&&G[b].close();3===K.readyState&&L===!1?(A.console("Connection closed. ( code: "+a.code+" ) Attempting reconnection in "+s.reconnectDelay/1e3+' seconds. ( <a class="actionLink" data-action="cancelConnect" title="Cancel" href="#">Cancel</a> | <a class="actionLink" data-action="reconnect" title="Reconnect" href="#">Reconnect now</a> )',"error"),clearTimeout(O),P=setTimeout(function(){N.connect()},s.reconnectDelay)):L===!0?(A.console("Connection closed. ( code: "+a.code+' ) <a class="actionLink" data-action="reconnect" title="Reconnect" href="#">Reconnect?</a>',"error"),clearTimeout(O)):A.console("Connection closed. ( code: "+a.code+" )")},K.onopen=function(){A.console("Connecting to "+k+"..."),T.login(!0)},K.onmessage=function(b){T.tapTimeout();var c=b.data.toString().split("\r\n");M!==!1&&(c[0]=M+c[0],M=!1),""!==c[c.length-1]?M=c.pop():c.pop();for(var d=0;d<c.length;d++)a(c[d])}}},O=null,P=null,Q=[],q=0;q<s.sendLimitMessages;q++)Q.push(0);var R=0,S=["multi-prefix","twitch.tv/membership"],T={join:function(a){if("string"==typeof a&&(a=a.trim().split(" ")),a.length>0)for(var b=0;b<a.length;b++)"undefined"==typeof G[a[b]]?T.sendNow("JOIN "+a):$('div.chatArea[title="'+a[b]+'"]').is(":visible")===!1&&h(a[b]);else A.active("No channels specified in join command!","error")},nick:function(a){T.sendNow("NICK "+a);var b=s.nick;s.updateNick(a);for(var c=0;c<G.length;c++)G[c].user.nick(b,a)},part:function(a,b){T.sendNow("PART "+a+" :"+("undefined"!=typeof b?b:"I clicked a thing!"))},quit:function(a){L=!0,clearTimeout(O),"undefined"==typeof a&&(a="Kyaiee!"),T.sendNow("QUIT :"+a),N.close(),A.console('<span class="warning">You have disconnected from this server ( <a class="actionLink" data-action="reconnect" title="Cancel">Click here to reconnect</a> )</span>')},tapTimeout:function(){clearTimeout(O),O=setTimeout(function(){A.notification("Connection timed out. Reconnecting...","error"),T.forceReconnect()},s.timeout)},send:function(b){Q[0]>Date.now()-s.sendLimitWindow?A.active("Client flood limiter exceeded, Message was not sent","warning"):(T.sendNow(b),a(b,!0),Q.push(Date.now()),Q.shift())},sendNow:function(a){a.length>510&&(a=a.substr(0,510)),N.send(a+"\r\n"),T.tapTimeout()},forceReconnect:function(){N.close(),clearTimeout(P),P=null,N.connect()},login:function(a){if(a===!0&&(R=0),0===R)T.sendNow("CAP LS");else if(1===R){for(var b=[],c=0;c<S.length;c++)-1!==s.CAP.LS.indexOf(S[c])&&b.push(S[c]);if(-1!==s.CAP.LS.indexOf("sasl")&&null!==l.token&&l.token.length>0?b.push("sasl"):null!==l.token&&l.token.length>0&&T.sendNow("PASS "+l.token),T.sendNow("NICK "+s.nick),T.sendNow("USER "+s.nick+" "+s.nick+" "+s.nick+" :"+s.nick),b.length>0){var d="";1==b.length?d=b[0]:(d+=":",d+=b.join(" ")),T.sendNow("CAP REQ "+d)}}else 2===R&&-1!==s.CAP.ACK.indexOf("sasl")&&null!==l.token?T.sendNow("AUTHENTICATE PLAIN"):(R=3,T.sendNow("CAP END"))},topic:function(a,b){"undefined"==typeof b||null===b||0===b.length?T.send("TOPIC "+a):T.send("TOPIC "+a+" :"+b)},privmsg:function(a,b){T.send("PRIVMSG "+a+" :"+b)},action:function(a,b){T.send("PRIVMSG "+a+" :"+String.fromCharCode(1)+"ACTION "+b+String.fromCharCode(1))},notice:function(a,b){T.send("NOTICE "+a+" :"+b)}};$(document).ready(function(){N.connect()}),$(window).unload(function(){T.quit("Browser closed")}),window.onbeforeunload=function(){return"Navigating away from this page will disconnect you from the chat. Please don't leave us"}}();